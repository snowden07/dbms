CREATE TABLE PUBLISHER(PUBL_NAME VARCHAR (20) PRIMARY KEY,PHONE BIGINT, ADDRESS VARCHAR (20));

CREATE TABLE BOOK
(BOOK_ID INTEGER PRIMARY KEY, TITLE VARCHAR (20), PUB_YEAR VARCHAR (20),PUBL_NAME varchar(20),FOREIGN KEY (PUBL_NAME) REFERENCES PUBLISHER (PUBL_NAME) ON DELETE CASCADE);

CREATE TABLE BOOK_AUTHORS(AUTHOR_NAME VARCHAR (20), BOOK_ID int, FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE, PRIMARY KEY (BOOK_ID, AUTHOR_NAME));

CREATE TABLE LIBRARY_BRANCH (BRANCH_ID INTEGER PRIMARY KEY, BRANCH_NAME VARCHAR (50), ADDRESS VARCHAR (50));

CREATE TABLE BOOK_COPIES (NO_OF_COPIES INTEGER, Book_id int, branch_id int, FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE, FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH (BRANCH_ID) ON DELETE CASCADE, PRIMARY KEY (BOOK_ID, BRANCH_ID));

CREATE TABLE CARD(CARD_NO INTEGER PRIMARY KEY); 

CREATE TABLE BOOK_LENDING (DATE_OUT DATE, DUE_DATE DATE,Book_id int,Branch_id int,card_no int, FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE, FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH (BRANCH_ID) ON DELETE CASCADE, FOREIGN KEY (CARD_NO) REFERENCES CARD (CARD_NO) ON DELETE CASCADE, PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO));

1. Retrieve details of all books in the library â€“ id, title, name of publisher, authors, number of copies in each branch, etc.
Sol:
Use lab2;
SELECT B.BOOK_ID, B.TITLE, B.PUBL_NAME, A.AUTHOR_NAME,
C.NO_OF_COPIES, L.BRANCH_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID=A.BOOK_ID
AND B.BOOK_ID=C.BOOK_ID
AND L.BRANCH_ID=C.BRANCH_ID;

2. Get the particulars of borrowers who have borrowed more than 3 books, but from
Jan 2017 to Jun 2017.
Sol:
use lab2;
SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-01-21' AND '2017-09-15'
GROUP BY CARD_NO
HAVING COUNT(*)>3;

3.Delete a book in BOOK table. Update the contents of other tables to reflect this data
manipulation operation.
Sol:
DELETE FROM BOOK
WHERE BOOK_ID=3;

4. Partition the BOOK table based on year of publication. Demonstrate its working with a
simple query.
Sol:
CREATE VIEW V_PUBLICATION AS
SELECT PUB_YEAR
FROM BOOK;

5. Create a view of all books and its number of copies that are currently available in the library.
Sol:
CREATE VIEW V_BOOKS AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM BOOK B, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID=C.BOOK_ID
AND C.BRANCH_ID=L.BRANCH_ID;
